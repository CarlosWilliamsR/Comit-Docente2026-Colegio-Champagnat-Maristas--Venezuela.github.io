// ============================================
// TRANSLATIONS (i18n)
// ============================================

const translations = {
    es: {
        // Navigation
        "nav.home": "Inicio",
        "nav.mentors": "Mentores",
        "nav.wellness": "Bienestar",
        "nav.impact": "Impacto",

        // Hero Section
        "hero.badge": "Convocatoria Abierta 2026",
        "hero.title1": "Tu experiencia",
        "hero.title2": "es nuestra brújula",
        "hero.description": "La fuerza de nuestro colegio no está en las paredes, sino en las personas. Te invitamos a liderar la transformación de nuestra cultura escolar uniéndote a nuestros nuevos comités estratégicos.",
        "hero.cta": "¡Inscríbete Ahora!",
        "hero.secondary": "Conocer más",

        // Induction Section
        "induction.subtitle": "Comité de Inducción",
        "induction.title": "Sé un Mentor de Excelencia",
        "induction.description": "¿Recuerdas tu primer día? Buscamos profesores con trayectoria para guiar a los nuevos talentos. No se trata solo de enseñar procesos, sino de transmitir nuestra mística.",
        "induction.chart.title": "Perfil del Mentor Ideal",
        "induction.chart.caption": "Habilidades clave para el rol de mentoría.",
        "induction.feature1.title": "Acompañamiento Cercano",
        "induction.feature1.desc": "Sé el primer punto de contacto. Ayuda a navegar la logística escolar y las normas no escritas de nuestra comunidad.",
        "induction.feature2.title": "Guía Cultural",
        "induction.feature2.desc": "Transmite los valores y tradiciones que nos hacen únicos. Asegura que la identidad del colegio perdure.",
        "induction.feature3.title": "Impulsor de Talento",
        "induction.feature3.desc": "Potencia las habilidades de los nuevos ingresos, ofreciendo retroalimentación constructiva y apoyo emocional.",

        // Wellness Section
        "wellness.subtitle": "Comité de Bienestar",
        "wellness.title": "Institucionalicemos la Alegría",
        "wellness.description": "Un equipo que se divierte unido, trabaja mejor. Este comité diseñará las experiencias que nos recargan de energía y fortalecen nuestros lazos.",
        "wellness.intro": "Buscamos mentes creativas y corazones activos para organizar un abanico de actividades. Desde torneos deportivos relámpago hasta salidas culturales enriquecedoras.",
        "wellness.list.title": "¿Qué organizaremos?",
        "wellness.list.item1": "Torneos deportivos (Fútbol, Voleibol)",
        "wellness.list.item2": "Club de lectura y cine",
        "wellness.list.item3": "Convivios temáticos mensuales",
        "wellness.list.item4": "Pausas activas y bienestar físico",
        "wellness.chart.title": "Universo de Actividades Propuestas",
        "wellness.chart.caption": "Distribución jerárquica de iniciativas de bienestar.",

        // Impact Section
        "impact.title": "¿Por qué unirte?",
        "impact.description": "Participar en estos comités no es solo \"más trabajo\", es una oportunidad de crecimiento personal y profesional. Es tu oportunidad de dejar una marca indeleble en la institución.",
        "impact.card1.title": "Liderazgo",
        "impact.card1.desc": "Desarrolla habilidades de gestión y coordinación de equipos.",
        "impact.card2.title": "Networking",
        "impact.card2.desc": "Conecta con colegas de otras áreas y niveles.",
        "impact.card3.title": "Clima Laboral",
        "impact.card3.desc": "Contribuye directamente a un ambiente más feliz.",
        "impact.card4.title": "Reconocimiento",
        "impact.card4.desc": "Certificación oficial de participación en comités.",
        "impact.chart.title": "Nivel de Impacto Proyectado",

        // Contact Section
        "contact.title": "¡Hagamos Equipo!",
        "contact.deadline": "Las inscripciones están abiertas hasta el",
        "contact.deadline.date": "[Fecha Límite]",
        "contact.register.label": "Regístrate con",
        "contact.register.name": "[Nombre del Coordinador]",
        "contact.location.label": "Lugar",
        "contact.location.name": "Sala de Profesores",

        // Footer
        "footer.school": "Colegio Champagnat",
        "footer.location": "Hermanos Maristas • Caracas, Venezuela",
        "footer.copyright": "© 2026 Colegio Champagnat Caracas.",
        "footer.rights": "Todos los derechos reservados.",

        // Radar Chart Labels (Mentor Profile)
        "chart.radar.empathy": "Empatía y Escucha",
        "chart.radar.experience": "Experiencia Docente",
        "chart.radar.collaborative": "Espíritu Colaborativo",
        "chart.radar.communication": "Comunicación Asertiva",
        "chart.radar.proactivity": "Proactividad",
        "chart.radar.dataset": "Nivel Requerido",

        // Sunburst Chart Labels (Wellness)
        "chart.sunburst.wellness": "Bienestar",
        "chart.sunburst.sports": "Deportes",
        "chart.sunburst.culture": "Cultura",
        "chart.sunburst.social": "Social",
        "chart.sunburst.soccer": "Fútbol",
        "chart.sunburst.volleyball": "Voleibol",
        "chart.sunburst.yoga": "Yoga",
        "chart.sunburst.movies": "Cine",
        "chart.sunburst.museums": "Museos",
        "chart.sunburst.parties": "Fiestas",
        "chart.sunburst.coffee": "Café",

        // Bar Chart Labels (Impact)
        "chart.bar.climate": "Clima Laboral",
        "chart.bar.retention": "Retención",
        "chart.bar.integration": "Integración",
        "chart.bar.satisfaction": "Satisfacción",
        "chart.bar.climate.full": "Mejora del Clima Laboral",
        "chart.bar.retention.full": "Retención de Talento",
        "chart.bar.integration.full": "Integración de Equipos",
        "chart.bar.satisfaction.full": "Satisfacción Laboral",
        "chart.bar.dataset": "Impacto Potencial (%)"
    },
    en: {
        // Navigation
        "nav.home": "Home",
        "nav.mentors": "Mentors",
        "nav.wellness": "Wellness",
        "nav.impact": "Impact",

        // Hero Section
        "hero.badge": "Open Call 2026",
        "hero.title1": "Your experience",
        "hero.title2": "is our compass",
        "hero.description": "The strength of our school lies not in its walls, but in its people. We invite you to lead the transformation of our school culture by joining our new strategic committees.",
        "hero.cta": "Sign Up Now!",
        "hero.secondary": "Learn More",

        // Induction Section
        "induction.subtitle": "Induction Committee",
        "induction.title": "Be a Mentor of Excellence",
        "induction.description": "Remember your first day? We're looking for experienced teachers to guide new talents. It's not just about teaching processes, but about transmitting our spirit.",
        "induction.chart.title": "Ideal Mentor Profile",
        "induction.chart.caption": "Key skills for the mentoring role.",
        "induction.feature1.title": "Close Support",
        "induction.feature1.desc": "Be the first point of contact. Help navigate school logistics and the unwritten rules of our community.",
        "induction.feature2.title": "Cultural Guide",
        "induction.feature2.desc": "Transmit the values and traditions that make us unique. Ensure the school's identity endures.",
        "induction.feature3.title": "Talent Promoter",
        "induction.feature3.desc": "Enhance the skills of new hires, offering constructive feedback and emotional support.",

        // Wellness Section
        "wellness.subtitle": "Wellness Committee",
        "wellness.title": "Let's Institutionalize Joy",
        "wellness.description": "A team that has fun together, works better together. This committee will design experiences that recharge our energy and strengthen our bonds.",
        "wellness.intro": "We're looking for creative minds and active hearts to organize a range of activities. From quick sports tournaments to enriching cultural outings.",
        "wellness.list.title": "What will we organize?",
        "wellness.list.item1": "Sports tournaments (Soccer, Volleyball)",
        "wellness.list.item2": "Book and movie club",
        "wellness.list.item3": "Monthly themed gatherings",
        "wellness.list.item4": "Active breaks and physical wellness",
        "wellness.chart.title": "Universe of Proposed Activities",
        "wellness.chart.caption": "Hierarchical distribution of wellness initiatives.",

        // Impact Section
        "impact.title": "Why Join?",
        "impact.description": "Participating in these committees isn't just \"more work\", it's an opportunity for personal and professional growth. It's your chance to leave an indelible mark on the institution.",
        "impact.card1.title": "Leadership",
        "impact.card1.desc": "Develop team management and coordination skills.",
        "impact.card2.title": "Networking",
        "impact.card2.desc": "Connect with colleagues from other areas and levels.",
        "impact.card3.title": "Work Environment",
        "impact.card3.desc": "Directly contribute to a happier workplace.",
        "impact.card4.title": "Recognition",
        "impact.card4.desc": "Official certification of committee participation.",
        "impact.chart.title": "Projected Impact Level",

        // Contact Section
        "contact.title": "Let's Team Up!",
        "contact.deadline": "Registration is open until",
        "contact.deadline.date": "[Deadline]",
        "contact.register.label": "Register with",
        "contact.register.name": "[Coordinator Name]",
        "contact.location.label": "Location",
        "contact.location.name": "Teachers' Room",

        // Footer
        "footer.school": "Colegio Champagnat",
        "footer.location": "Marist Brothers • Caracas, Venezuela",
        "footer.copyright": "© 2026 Colegio Champagnat Caracas.",
        "footer.rights": "All rights reserved.",

        // Radar Chart Labels (Mentor Profile)
        "chart.radar.empathy": "Empathy & Listening",
        "chart.radar.experience": "Teaching Experience",
        "chart.radar.collaborative": "Collaborative Spirit",
        "chart.radar.communication": "Assertive Communication",
        "chart.radar.proactivity": "Proactivity",
        "chart.radar.dataset": "Required Level",

        // Sunburst Chart Labels (Wellness)
        "chart.sunburst.wellness": "Wellness",
        "chart.sunburst.sports": "Sports",
        "chart.sunburst.culture": "Culture",
        "chart.sunburst.social": "Social",
        "chart.sunburst.soccer": "Soccer",
        "chart.sunburst.volleyball": "Volleyball",
        "chart.sunburst.yoga": "Yoga",
        "chart.sunburst.movies": "Movies",
        "chart.sunburst.museums": "Museums",
        "chart.sunburst.parties": "Parties",
        "chart.sunburst.coffee": "Coffee",

        // Bar Chart Labels (Impact)
        "chart.bar.climate": "Work Climate",
        "chart.bar.retention": "Retention",
        "chart.bar.integration": "Integration",
        "chart.bar.satisfaction": "Satisfaction",
        "chart.bar.climate.full": "Work Climate Improvement",
        "chart.bar.retention.full": "Talent Retention",
        "chart.bar.integration.full": "Team Integration",
        "chart.bar.satisfaction.full": "Job Satisfaction",
        "chart.bar.dataset": "Potential Impact (%)"
    }
};

let currentLanguage = 'es';

// ============================================
// THEME MANAGEMENT
// ============================================

/**
 * Initialize theme - defaults to light mode
 */
function initTheme() {
    const savedTheme = localStorage.getItem('theme');

    // Always default to light theme, only use dark if explicitly saved
    if (savedTheme === 'dark') {
        setTheme('dark');
    } else {
        setTheme('light');
    }

    // Listen for system theme changes (optional, user can still toggle)
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        // Only auto-switch if user hasn't set a preference
        if (!localStorage.getItem('theme')) {
            setTheme('light'); // Keep light as default
        }
    });
}

/**
 * Set theme and update DOM
 */
function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
}

/**
 * Toggle between light and dark theme
 */
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    setTheme(newTheme);
}

/**
 * Initialize theme toggle button
 */
function initThemeToggle() {
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }
}

// ============================================
// LANGUAGE MANAGEMENT (i18n)
// ============================================

/**
 * Initialize language - defaults to Spanish
 */
function initLanguage() {
    const savedLang = localStorage.getItem('language');

    // Always default to Spanish, only use English if explicitly saved
    if (savedLang === 'en') {
        setLanguage('en');
    } else {
        setLanguage('es');
    }
}

/**
 * Set language and update all translatable elements
 */
function setLanguage(lang) {
    if (!translations[lang]) return;

    currentLanguage = lang;
    localStorage.setItem('language', lang);

    // Update all elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });

    // Update language buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
    });

    // Update HTML lang attribute
    document.documentElement.setAttribute('lang', lang);

    // Refresh charts with new language
    refreshAllCharts();
}

/**
 * Initialize language selector buttons
 */
function initLanguageSelector() {
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            setLanguage(lang);
        });
    });
}

// ============================================
// HELPER FUNCTIONS
// ============================================

/**
 * Wraps long labels for better display in charts
 * @param {string} label - The label to wrap
 * @param {number} maxLength - Maximum characters per line
 * @returns {string|string[]} - Wrapped label
 */
function wrapLabel(label, maxLength = 16) {
    if (label.length <= maxLength) return label;
    const words = label.split(' ');
    const lines = [];
    let currentLine = words[0];

    for (let i = 1; i < words.length; i++) {
        if ((currentLine + " " + words[i]).length <= maxLength) {
            currentLine += " " + words[i];
        } else {
            lines.push(currentLine);
            currentLine = words[i];
        }
    }
    lines.push(currentLine);
    return lines;
}

// Common tooltip configuration for Chart.js
const commonTooltipConfig = {
    callbacks: {
        title: function (tooltipItems) {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            } else {
                return label;
            }
        }
    }
};

// ============================================
// NAVBAR SCROLL EFFECT
// ============================================

/**
 * Initialize navbar scroll effect
 */
function initNavbarScrollEffect() {
    const navbar = document.querySelector('.navbar');
    if (!navbar) return;

    let lastScroll = 0;
    const scrollThreshold = 50;

    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;

        // Add scrolled class when scrolled past threshold
        if (currentScroll > scrollThreshold) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }

        lastScroll = currentScroll;
    }, { passive: true });
}

// ============================================
// SMOOTH SCROLL FOR ANCHOR LINKS
// ============================================

/**
 * Initialize smooth scrolling for navigation links
 */
function initSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);

            if (targetElement) {
                const navbarHeight = document.querySelector('.navbar')?.offsetHeight || 0;
                const targetPosition = targetElement.offsetTop - navbarHeight - 20;

                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });

                // Update active nav link
                updateActiveNavLink(targetId);
            }
        });
    });
}

/**
 * Update active navigation link
 */
function updateActiveNavLink(targetId) {
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === targetId) {
            link.classList.add('active');
        }
    });
}

// ============================================
// SCROLL REVEAL ANIMATIONS
// ============================================

/**
 * Initialize scroll reveal animations
 */
function initScrollReveal() {
    const observerOptions = {
        root: null,
        rootMargin: '0px 0px -100px 0px',
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('revealed');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    // Add scroll-reveal class to elements
    const elementsToAnimate = document.querySelectorAll(
        '#induccion .glass-card, #induccion .space-y-6 > div, ' +
        '#bienestar .glass-card, #bienestar .bg-emerald-50, ' +
        '#impacto .bg-blue-800, #contacto .bg-gray-50'
    );

    elementsToAnimate.forEach((el, index) => {
        el.classList.add('scroll-reveal');
        el.style.transitionDelay = `${index * 100}ms`;
        observer.observe(el);
    });
}

// ============================================
// ACTIVE SECTION DETECTION
// ============================================

/**
 * Detect which section is currently in view and update nav
 */
function initActiveSectionDetection() {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link');

    const observerOptions = {
        root: null,
        rootMargin: '-20% 0px -60% 0px',
        threshold: 0
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const id = entry.target.getAttribute('id');
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${id}`) {
                        link.classList.add('active');
                    }
                });
            }
        });
    }, observerOptions);

    sections.forEach(section => observer.observe(section));
}

// ============================================
// CHART INITIALIZATION
// ============================================

// Global chart instances for updates
let radarChartInstance = null;
let barChartInstance = null;

/**
 * Get translated chart labels
 */
function getChartTranslations() {
    const t = translations[currentLanguage];
    return {
        radar: {
            labels: [
                t['chart.radar.empathy'],
                t['chart.radar.experience'],
                t['chart.radar.collaborative'],
                t['chart.radar.communication'],
                t['chart.radar.proactivity']
            ],
            dataset: t['chart.radar.dataset']
        },
        sunburst: {
            labels: [
                t['chart.sunburst.wellness'],
                t['chart.sunburst.sports'],
                t['chart.sunburst.culture'],
                t['chart.sunburst.social'],
                t['chart.sunburst.soccer'],
                t['chart.sunburst.volleyball'],
                t['chart.sunburst.yoga'],
                t['chart.sunburst.movies'],
                t['chart.sunburst.museums'],
                t['chart.sunburst.parties'],
                t['chart.sunburst.coffee']
            ],
            parents: ['',
                t['chart.sunburst.wellness'],
                t['chart.sunburst.wellness'],
                t['chart.sunburst.wellness'],
                t['chart.sunburst.sports'],
                t['chart.sunburst.sports'],
                t['chart.sunburst.sports'],
                t['chart.sunburst.culture'],
                t['chart.sunburst.culture'],
                t['chart.sunburst.social'],
                t['chart.sunburst.social']
            ]
        },
        bar: {
            labels: [
                t['chart.bar.climate'],
                t['chart.bar.retention'],
                t['chart.bar.integration'],
                t['chart.bar.satisfaction']
            ],
            fullLabels: [
                t['chart.bar.climate.full'],
                t['chart.bar.retention.full'],
                t['chart.bar.integration.full'],
                t['chart.bar.satisfaction.full']
            ],
            dataset: t['chart.bar.dataset']
        }
    };
}

/**
 * Refresh all charts with current language
 */
function refreshAllCharts() {
    // Only refresh if charts are already initialized
    if (radarChartInstance) {
        const chartTrans = getChartTranslations();
        radarChartInstance.data.labels = chartTrans.radar.labels.map(l => wrapLabel(l));
        radarChartInstance.data.datasets[0].label = chartTrans.radar.dataset;
        radarChartInstance.update('none');
    }

    if (barChartInstance) {
        const chartTrans = getChartTranslations();
        barChartInstance.data.labels = chartTrans.bar.labels;
        barChartInstance.data.datasets[0].label = chartTrans.bar.dataset;
        // Update tooltip callback with new translations
        barChartInstance.options.plugins.tooltip.callbacks.title = function (tooltipItems) {
            return chartTrans.bar.fullLabels[tooltipItems[0].dataIndex];
        };
        barChartInstance.update('none');
    }

    // Refresh Plotly sunburst chart
    const sunburstDiv = document.getElementById('sunburstDiv');
    if (sunburstDiv && sunburstDiv.data) {
        const chartTrans = getChartTranslations();
        Plotly.restyle('sunburstDiv', {
            labels: [chartTrans.sunburst.labels],
            parents: [chartTrans.sunburst.parents]
        });
    }
}

/**
 * Initialize the Radar Chart for Mentor Profile
 */
function initRadarChart() {
    const ctxRadar = document.getElementById('radarMentorChart');
    if (!ctxRadar) return;

    const ctx = ctxRadar.getContext('2d');
    const chartTrans = getChartTranslations();
    const processedRadarLabels = chartTrans.radar.labels.map(l => wrapLabel(l));

    radarChartInstance = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: processedRadarLabels,
            datasets: [{
                label: chartTrans.radar.dataset,
                data: [95, 85, 90, 85, 80],
                fill: true,
                backgroundColor: 'rgba(37, 99, 235, 0.15)',
                borderColor: '#2563EB',
                pointBackgroundColor: '#2563EB',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: '#2563EB',
                borderWidth: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            elements: {
                line: {
                    borderWidth: 3,
                    tension: 0.1
                },
                point: {
                    radius: 5,
                    hoverRadius: 8
                }
            },
            scales: {
                r: {
                    angleLines: {
                        color: 'rgba(0,0,0,0.08)',
                        lineWidth: 1
                    },
                    grid: {
                        color: 'rgba(0,0,0,0.06)',
                        circular: true
                    },
                    pointLabels: {
                        font: {
                            size: 11,
                            family: 'Inter',
                            weight: '500'
                        },
                        color: '#4B5563'
                    },
                    suggestedMin: 0,
                    suggestedMax: 100,
                    ticks: {
                        display: false,
                        stepSize: 20
                    }
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    ...commonTooltipConfig,
                    backgroundColor: 'rgba(31, 41, 55, 0.95)',
                    titleFont: { family: 'Inter', weight: '600' },
                    bodyFont: { family: 'Inter' },
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeOutQuart'
            }
        }
    });
}

/**
 * Initialize the Plotly Sunburst Chart for Wellness Activities
 */
function initSunburstChart() {
    const sunburstDiv = document.getElementById('sunburstDiv');
    if (!sunburstDiv) return;

    const chartTrans = getChartTranslations();

    const sunburstData = [{
        type: "sunburst",
        labels: chartTrans.sunburst.labels,
        parents: chartTrans.sunburst.parents,
        values: [100, 40, 30, 30, 20, 10, 10, 15, 15, 15, 15],
        leaf: { opacity: 0.6 },
        marker: {
            line: {
                width: 2,
                color: 'white'
            }
        },
        branchvalues: 'total',
        insidetextorientation: 'radial',
        textfont: {
            family: 'Inter',
            size: 13
        },
        hoverlabel: {
            font: { family: 'Inter' }
        }
    }];

    const sunburstLayout = {
        margin: { l: 10, r: 10, b: 10, t: 10 },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { family: 'Inter', size: 14 },
        colorway: ['#10B981', '#3B82F6', '#F59E0B', '#8B5CF6'],
        hoverlabel: {
            bgcolor: 'rgba(31, 41, 55, 0.95)',
            bordercolor: 'transparent',
            font: {
                family: 'Inter',
                color: 'white'
            }
        }
    };

    Plotly.newPlot('sunburstDiv', sunburstData, sunburstLayout, {
        displayModeBar: false,
        responsive: true
    });
}

/**
 * Initialize the Horizontal Bar Chart for Impact
 */
function initBarChart() {
    const ctxBar = document.getElementById('impactBarChart');
    if (!ctxBar) return;

    const ctx = ctxBar.getContext('2d');
    const chartTrans = getChartTranslations();

    barChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartTrans.bar.labels,
            datasets: [{
                label: chartTrans.bar.dataset,
                data: [95, 80, 90, 85],
                backgroundColor: [
                    'rgba(255, 255, 255, 0.9)',
                    'rgba(255, 255, 255, 0.75)',
                    'rgba(255, 255, 255, 0.85)',
                    'rgba(255, 255, 255, 0.8)'
                ],
                borderColor: 'rgba(255, 255, 255, 1)',
                borderWidth: 0,
                borderRadius: 6,
                borderSkipped: false
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            layout: {
                padding: {
                    left: 10,
                    right: 20
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.08)',
                        drawBorder: false
                    },
                    ticks: {
                        color: 'rgba(255,255,255,0.7)',
                        font: { family: 'Inter', size: 11 }
                    },
                    border: { display: false },
                    max: 100
                },
                y: {
                    grid: { display: false },
                    ticks: {
                        color: 'white',
                        font: {
                            family: 'Inter',
                            weight: '600',
                            size: 11
                        },
                        padding: 8
                    },
                    border: { display: false }
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        title: function (tooltipItems) {
                            const chartTrans = getChartTranslations();
                            return chartTrans.bar.fullLabels[tooltipItems[0].dataIndex];
                        }
                    },
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#1F2937',
                    bodyColor: '#1F2937',
                    titleFont: { family: 'Inter', weight: '600' },
                    bodyFont: { family: 'Inter' },
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeOutQuart'
            }
        }
    });
}

// ============================================
// HERO SLIDER - ENHANCED VERSION WITH BG SYNC
// ============================================

class HeroSlider {
    constructor(options = {}) {
        this.container = document.querySelector('.hero-slider');
        if (!this.container) return;

        this.slides = this.container.querySelectorAll('.hero-slide');
        this.dots = this.container.querySelectorAll('.slider-dot');
        this.prevBtn = this.container.querySelector('.slider-nav-btn.prev');
        this.nextBtn = this.container.querySelector('.slider-nav-btn.next');
        this.progressBar = this.container.querySelector('.slider-progress');

        // Background slides for the blurred effect
        this.bgSlides = document.querySelectorAll('.hero-bg-slide');

        this.currentIndex = 0;
        this.totalSlides = this.slides.length;
        this.autoplayInterval = options.autoplayInterval || 5000;
        this.isAutoplayEnabled = options.autoplay !== false;
        this.autoplayTimer = null;
        this.progressTimer = null;
        this.progressValue = 0;
        this.isTransitioning = false;

        this.init();
    }

    init() {
        if (this.totalSlides === 0) return;

        // Bind event listeners
        if (this.prevBtn) {
            this.prevBtn.addEventListener('click', () => this.prev());
        }
        if (this.nextBtn) {
            this.nextBtn.addEventListener('click', () => this.next());
        }

        // Dot navigation
        this.dots.forEach((dot, index) => {
            dot.addEventListener('click', () => this.goTo(index));
        });

        // Pause on hover
        this.container.addEventListener('mouseenter', () => this.pauseAutoplay());
        this.container.addEventListener('mouseleave', () => this.startAutoplay());

        // Touch/Swipe support
        this.setupTouchEvents();

        // Keyboard navigation (only when slider is in viewport)
        this.setupKeyboardNavigation();

        // Visibility API - pause when tab is hidden
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                this.pauseAutoplay();
            } else {
                this.startAutoplay();
            }
        });

        // Start
        this.showSlide(0);
        if (this.isAutoplayEnabled) {
            this.startAutoplay();
        }
    }

    showSlide(index) {
        if (this.isTransitioning) return;

        // Ensure index is within bounds
        if (index < 0) index = this.totalSlides - 1;
        if (index >= this.totalSlides) index = 0;

        this.isTransitioning = true;

        // Update main slides
        this.slides.forEach((slide, i) => {
            slide.classList.toggle('active', i === index);
        });

        // Update background slides (synced with main slider)
        this.bgSlides.forEach((slide, i) => {
            slide.classList.toggle('active', i === index);
        });

        // Update dots
        this.dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });

        this.currentIndex = index;
        this.resetProgress();

        // Reset transition lock
        setTimeout(() => {
            this.isTransitioning = false;
        }, 700);
    }

    next() {
        this.showSlide(this.currentIndex + 1);
    }

    prev() {
        this.showSlide(this.currentIndex - 1);
    }

    goTo(index) {
        if (index !== this.currentIndex) {
            this.showSlide(index);
        }
    }

    startAutoplay() {
        if (!this.isAutoplayEnabled) return;

        this.pauseAutoplay();
        this.autoplayTimer = setInterval(() => {
            this.next();
        }, this.autoplayInterval);

        this.startProgress();
    }

    pauseAutoplay() {
        if (this.autoplayTimer) {
            clearInterval(this.autoplayTimer);
            this.autoplayTimer = null;
        }
        if (this.progressTimer) {
            clearInterval(this.progressTimer);
            this.progressTimer = null;
        }
    }

    startProgress() {
        if (!this.progressBar) return;

        this.progressValue = 0;
        this.progressBar.style.width = '0%';

        const step = 100 / (this.autoplayInterval / 50);
        this.progressTimer = setInterval(() => {
            this.progressValue += step;
            if (this.progressValue >= 100) {
                this.progressValue = 100;
            }
            this.progressBar.style.width = this.progressValue + '%';
        }, 50);
    }

    resetProgress() {
        this.progressValue = 0;
        if (this.progressBar) {
            this.progressBar.style.width = '0%';
        }
        if (this.isAutoplayEnabled && this.autoplayTimer) {
            if (this.progressTimer) {
                clearInterval(this.progressTimer);
            }
            this.startProgress();
        }
    }

    setupTouchEvents() {
        let startX = 0;
        let startY = 0;
        let isDragging = false;

        this.container.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isDragging = true;
            this.pauseAutoplay();
        }, { passive: true });

        this.container.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            // Prevent vertical scroll if horizontal swipe detected
            const diffX = Math.abs(e.touches[0].clientX - startX);
            const diffY = Math.abs(e.touches[0].clientY - startY);
            if (diffX > diffY && diffX > 10) {
                e.preventDefault();
            }
        }, { passive: false });

        this.container.addEventListener('touchend', (e) => {
            if (!isDragging) return;
            isDragging = false;

            const endX = e.changedTouches[0].clientX;
            const diff = startX - endX;

            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    this.next();
                } else {
                    this.prev();
                }
            }
            this.startAutoplay();
        }, { passive: true });
    }

    setupKeyboardNavigation() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    document.addEventListener('keydown', this.handleKeydown.bind(this));
                } else {
                    document.removeEventListener('keydown', this.handleKeydown.bind(this));
                }
            });
        }, { threshold: 0.5 });

        observer.observe(this.container);
    }

    handleKeydown(e) {
        if (e.key === 'ArrowLeft') {
            this.prev();
        } else if (e.key === 'ArrowRight') {
            this.next();
        }
    }
}

// ============================================
// OLD SLIDER (For compatibility - Section at bottom)
// ============================================

function initOldSlider() {
    const images = document.querySelectorAll('#image-slider .slider-image');
    const prevButton = document.querySelector('#image-slider .slider-button.prev');
    const nextButton = document.querySelector('#image-slider .slider-button.next');

    if (images.length === 0) return;

    let currentIndex = 0;

    function showImage(index) {
        images.forEach((img, i) => {
            img.classList.toggle('active', i === index);
        });
    }

    if (prevButton) {
        prevButton.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            showImage(currentIndex);
        });
    }

    if (nextButton) {
        nextButton.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % images.length;
            showImage(currentIndex);
        });
    }

    showImage(currentIndex);
}

// ============================================
// IMAGE LAZY LOADING
// ============================================

function initLazyLoading() {
    const images = document.querySelectorAll('img[loading="lazy"]');

    images.forEach(img => {
        if (img.complete) {
            img.classList.add('loaded');
        } else {
            img.addEventListener('load', () => {
                img.classList.add('loaded');
            });
        }
    });
}

// ============================================
// PARALLAX EFFECT (Subtle)
// ============================================

function initParallaxEffect() {
    const heroSliderWrapper = document.querySelector('.hero-slider-wrapper');
    if (!heroSliderWrapper || window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const rate = scrolled * 0.15;

        if (scrolled < window.innerHeight) {
            heroSliderWrapper.style.transform = `translateY(${rate}px)`;
        }
    }, { passive: true });
}

// ============================================
// COUNTER ANIMATION
// ============================================

function animateCounter(element, target, duration = 2000) {
    const start = 0;
    const startTime = performance.now();

    function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        // Easing function
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        const current = Math.round(start + (target - start) * easeOutQuart);

        element.textContent = current;

        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }

    requestAnimationFrame(update);
}

// ============================================
// RIPPLE EFFECT FOR BUTTONS
// ============================================

function initRippleEffect() {
    const buttons = document.querySelectorAll('.cta-button, .secondary-button');

    buttons.forEach(button => {
        button.addEventListener('click', function (e) {
            const ripple = document.createElement('span');
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;

            ripple.style.cssText = `
                position: absolute;
                width: ${size}px;
                height: ${size}px;
                left: ${x}px;
                top: ${y}px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                transform: scale(0);
                animation: ripple 0.6s ease-out;
                pointer-events: none;
            `;

            this.appendChild(ripple);

            setTimeout(() => ripple.remove(), 600);
        });
    });

    // Add ripple keyframe if not exists
    if (!document.querySelector('#ripple-style')) {
        const style = document.createElement('style');
        style.id = 'ripple-style';
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    }
}

// ============================================
// MOBILE MENU
// ============================================

function initMobileMenu() {
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
    const mobileMenuLinks = document.querySelectorAll('.mobile-menu-link');

    if (!mobileMenuBtn || !mobileMenu) return;

    // Toggle mobile menu
    function toggleMobileMenu() {
        const isOpen = mobileMenu.classList.contains('active');

        if (isOpen) {
            closeMobileMenu();
        } else {
            openMobileMenu();
        }
    }

    function openMobileMenu() {
        mobileMenu.classList.add('active');
        mobileMenuOverlay.classList.add('active');
        mobileMenuBtn.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
        mobileMenu.classList.remove('active');
        mobileMenuOverlay.classList.remove('active');
        mobileMenuBtn.classList.remove('active');
        document.body.style.overflow = '';
    }

    // Event listeners
    mobileMenuBtn.addEventListener('click', toggleMobileMenu);

    if (mobileMenuOverlay) {
        mobileMenuOverlay.addEventListener('click', closeMobileMenu);
    }

    // Close menu when clicking a link
    mobileMenuLinks.forEach(link => {
        link.addEventListener('click', () => {
            closeMobileMenu();

            // Update active state
            mobileMenuLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            // Also update desktop nav links
            document.querySelectorAll('.nav-link').forEach(navLink => {
                navLink.classList.remove('active');
                if (navLink.getAttribute('href') === link.getAttribute('href')) {
                    navLink.classList.add('active');
                }
            });
        });
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
            closeMobileMenu();
        }
    });

    // Close menu on resize to desktop
    window.addEventListener('resize', () => {
        if (window.innerWidth > 768 && mobileMenu.classList.contains('active')) {
            closeMobileMenu();
        }
    });

    // Sync active state with scroll detection
    const syncMobileMenuActive = () => {
        const activeNavLink = document.querySelector('.nav-link.active');
        if (activeNavLink) {
            const href = activeNavLink.getAttribute('href');
            mobileMenuLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === href);
            });
        }
    };

    // Observe changes to nav-link active state
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        const observer = new MutationObserver(syncMobileMenuActive);
        observer.observe(link, { attributes: true, attributeFilter: ['class'] });
    });
}

// ============================================
// INITIALIZATION
// ============================================

document.addEventListener('DOMContentLoaded', () => {
    // Theme & Language (must be first for immediate visual feedback)
    initTheme();
    initThemeToggle();
    initLanguage();
    initLanguageSelector();

    // UI Enhancements
    initNavbarScrollEffect();
    initSmoothScroll();
    initScrollReveal();
    initActiveSectionDetection();
    initLazyLoading();
    initRippleEffect();
    initMobileMenu();

    // Initialize all charts
    initRadarChart();
    initSunburstChart();
    initBarChart();

    // Initialize Hero Slider
    new HeroSlider({
        autoplay: true,
        autoplayInterval: 5000
    });

    // Initialize old slider for compatibility
    initOldSlider();

    // Optional: Parallax (disabled for performance, uncomment if needed)
    // initParallaxEffect();

    // Log initialization
    console.log('✅ Colegio Champagnat - All components initialized');
});

// Initialize on window load for images
window.addEventListener('load', () => {
    // Any post-load enhancements
    document.body.classList.add('loaded');
});
